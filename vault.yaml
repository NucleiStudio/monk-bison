namespace: /bison

vault:
  defines: runnable
  inherits: /vault/latest
  containers:
    defines: containers
    vault:
      hooks:
        container-started: inject-keys
  checks:
    defines: checks

    # super simple health check, if the container has started and
    # our action worked, we should see the keys in vault
    readyness:
      code: exec("vault", "vault", "kv", "list", "validators/dot") "validator_sk" contains?
      period: 15
      initialDelay: 13

  variables:
    defines: variables
    dot_validator_sk:
      type: string
      value: ""
    dot_validator_ed25519_pk:
      type: string
      value: ""
    dot_validator_sr25519_pk:
      type: string
      value: ""
    ksm_validator_sk:
      type: string
      value: ""
    ksm_validator_ed25519_pk:
      type: string
      value: ""
    ksm_validator_sr25519_pk:
      type: string
      value: ""
    
  actions:
    defines: actions
    inject-keys:
      code: |
        act("bison/vault/put", "path", "validators/dot", "key", "validator_sk", "value", `${dot_validator_sk}`)
        act("bison/vault/put", "path", "validators/dot", "key", "validator_ed25519_pk", "value", `${dot_validator_ed25519_pk}`)
        act("bison/vault/put", "path", "validators/dot", "key", "validator_sr25519_pk", "value", `${dot_validator_sr25519_pk}`)
        act("bison/vault/put", "path", "validators/ksm", "key", "validator_sk", "value", `${ksm_validator_sk}`)
        act("bison/vault/put", "path", "validators/ksm", "key", "validator_ed25519_pk", "value", `${ksm_validator_ed25519_pk}`)
        act("bison/vault/put", "path", "validators/ksm", "key", "validator_sr25519_pk", "value", `${ksm_validator_sr25519_pk}`)